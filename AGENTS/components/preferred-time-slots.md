Preferred Time Selection Component Integration Guide

1.  What this component does
    `PreferredSlotSelect` renders a weekly tabbed UI where users pick one or more preferred time slots per day.

- Days are shown as tabs.
- Clicking a day shows time-slot buttons for that day.
- Clicking a slot toggles selection (select/unselect).
- A small green dot appears on day tabs that have at least one selected slot.
- The component is **controlled** by parent state (`selectedSlots`) and callback (`setSlotsAction`).
  Source component: `components/preferred-slots-selection.tsx`

---

2.  UI output and behavior (current implementation)
    Days shown

- Generated by `getWeekDays({ weekStartOn: 0, filter: ['Monday'] })`
- `weekStartOn: 0` means Sunday-based week indexing.
- Monday is excluded, so UI shows 6 day tabs.
- Tab layout uses `grid-cols-6`, so it assumes 6 days.
  Time slots shown
- Generated by `getTimeSlots({ intervalMinutes: 60 })`
- Defaults in util:
  - `startHour = 15` (3:00 PM)
  - `endHour = 21` (9:00 PM)
  - inclusive end
- With 60-minute interval, slots are:
  - `03:00 PM` (`15:00`) ... `09:00 PM` (`21:00`) => 7 slots/day
    Interaction output shape
    Selections are stored in this shape:
    type TimeSlotSelection = {
    [dayNumber: number]: string[]; // e.g. 0 => ["15:00", "16:00"]
    };
    Example:
    {
    0: [15:00, 17:00],
    2: [18:00],
    6: [16:00, 19:00]
    }
    > Note: in JSON/DB, object keys become strings ("0", "2", etc.), which is expected by this codebase.

---

3. Required dependencies to copy
   Component-level imports

- Tabs, TabsList, TabsTrigger, TabsContent
- Button
- getTimeSlots, getWeekDays
- TimeSlotSelection type
  In this repo they come from:
- components/ui/tabs.tsx
- components/ui/button.tsx
- lib/utils.ts
- app/global-types.ts
  External package dependencies (indirect)
- @radix-ui/react-tabs (via Tabs UI wrapper)
- class-variance-authority + @radix-ui/react-slot (via Button UI wrapper)
- date-fns (inside getWeekDays and getTimeSlots)
- Tailwind CSS utility classes (styling)
  If your new project uses different UI primitives, replace Tabs/Button with equivalents and keep the same value/onClick behavior.

---

4. Data contract you must preserve (very important)
   The backend/event logic in this repo assumes:

- Keys are weekday numbers 0..6 (0=Sunday, 1=Monday, ... 6=Saturday)
- Values are arrays of 24h time strings in HH:mm format
- Example valid entry: { "3": ["15:00", "16:00"] }
  Validation reference:
- lib/validators/enrollment.ts expects record keys matching /^[0-6]$/
- computeEventTimes in lib/utils.ts parses HH:mm and maps weekday numbers
  If your DB schema differs, keep this shape at API boundary (or transform before persistence).

---

5. Porting checklist for a new project

- Copy component preferred-slots-selection.tsx
- Add/port type:
  export type TimeSlotSelection = { [dayNumber: number]: string[] };
  - Provide parent state + setter:
    const [preferredSlots, setPreferredSlots] = useState<TimeSlotSelection>({});
  - Render:
    <PreferredSlotSelect
      selectedSlots={preferredSlots}
      setSlotsAction={setPreferredSlots}
    />
  - Ensure utilities exist:
  - getWeekDays(...)
  - getTimeSlots(...)
- Ensure UI primitives exist:
  - Tabs + Button components (or equivalents)
- Ensure backend accepts/transforms payload shape

---

6. DB/schema migration notes
   If your new DB does not store preferred_time_slots as JSON:
   Option A (recommended): keep API contract, transform in service layer
   Receive:
   { 0: [15:00], 3: [18:00, 19:00] }
   Then map into your schema:

- Join table rows: (enrollment_id, weekday, time)
- Or flattened arrays with day/time objects
- Or cron/rrule records
  Option B: change frontend payload shape
  If you change frontend shape, also update:
- input validator
- event-generation/scheduling logic
- any API contracts relying on weekday-number keys + HH:mm

---

7. Known assumptions and pitfalls

- Monday is hard-filtered out (filter: ['Monday']).
- Tab column count is hardcoded to 6 (grid-cols-6) and tied to Monday exclusion.
- Day IDs depend on weekStartOn behavior in utility; changing week start can break weekday numbering contract.
- Component uses defaultValue for active tab (uncontrolled Tabs root). If you need active tab reset control, switch to controlled tabs.
- defaultSelected assumes at least one day exists after filter.

---

8. Suggested hardening before reuse (optional)

- Move these to props for configurability:
  - excluded days
  - start/end hour
  - interval minutes
  - session duration (if relevant to scheduler)
- Add guard/fallback when day list is empty.
- Add normalization step before submit:
  - remove empty arrays
  - sort slot arrays for stable payloads

---

9. Minimal acceptance test cases

1) Select slot on a day -> payload adds day -> [slot].
2) Toggle same slot again -> slot removed.
3) Multiple slots on same day -> array contains all selected.
4) Different days -> independent arrays per day.
5) Day tab shows indicator dot only when at least one slot exists.
6) Submitted payload keys are valid 0..6 and values HH:mm[].

---

10. Example payload for backend
    {
    student_id: stu_123,
    course_id: course_1,
    plan_code: PLN001,
    start_date: 2026-02-15,
    preferred_time_slots: {
    0: [15:00, 16:00],
    3: [18:00]
    }
    }
    This is the shape expected by scheduling logic like computeEventTimes.
